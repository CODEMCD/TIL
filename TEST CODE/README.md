# Test Code에 관해...
## 테스트 피라미드

- 참고 링크: [https://www.mountaingoatsoftware.com/blog/the-forgotten-layer-of-the-test-automation-pyramid](https://www.mountaingoatsoftware.com/blog/the-forgotten-layer-of-the-test-automation-pyramid)

유닛테스트, 통합 테스트, UI 테스트 가 있고, 순서대로 피라미드의 아래에 위치한다. 아래에 있을 수록 테스트 개수가 더 많다.

## 테스트에서 불편한 점

1. 인수테스트에서 테스트에 필요한 데이터를 설정하는 법
    - DirtiesContext 사용: 이는 테스트 속도를 엄청 느리게 한다.
    - 데이터베이스 데이터 삭제 로직 추가: 실제 프로덕션에서 삭제 로직이 데이터베이스 내부 데이터를 삭제 하지 않을 수 있다. 실제 대부분 데이터를 삭제하기 보다는 플래그를 둔다. 그러면 테스트만을 위한 삭제 로직을 추가해야하는데, 이 역시 테스트만을 위한 코드 프로덕션에 추가해야한다는 찜찜함이 있다.
    - data.sql: 더티컨텍스트를 사용하지 않아도 되서 테스트가 빠르다.
2. 기능 변경마다 테스트코드가 계속 변경된다.
    - 아직 테스트 코드를 작성하는 실력이 부족
    - 내부 구현을 테스트하고 있다.
3. 어느정도 테스트 코드를 작성해야할 지 모르겠다.
    - 현재는 취준으로 대부분 연습하고 있으므로 최대한 많은 테스트를 작성해보는 것이 좋을 것 같긴 하다.
4. 엔티티 테스트에서 id를 넣어줄 수 없을 때 리플렉션으로 넣으주는 유틸 코드를 만든다.

## 참고자료

- spring test reference 번역: [https://blog.outsider.ne.kr/859](https://blog.outsider.ne.kr/859)

- 서비스 mock 테스트가 필요할까?(기존에 하던) 지금 필요하다고 생각하는 테스트는 도메인 테스트와 인수 테스트이다. 서비스는 인수 테스트에서 충분히 테스트한다. 물론  인스테스트에서는 모든 것을 테스트하지만, 서비스는 인수의 핵심이라고 할 수 있는 도메인 조합과 트랜잭션 설정등을 하고 있다. 이를 굳이 mock으로 테스트해야할 지 잘 모르겠다. 필요성이 잘 느껴지지 않는다. 차라리 서비스 테스트 하나 더 만들바에 인수테스트에서 좀 더 다양한 테스트를 하는 것이 좋지 않을까...물론 인수 테스트가 많으면 더 느려지긴 한다. 근데 어차피 서비스에는 비즈니스 로직이 없다.(없게 만들어야 함)